# 图片懒加载解决方案

## 为什么使用图片懒加载？

为了性能

> DOMContentLoaded: 浏览器已完全加载完HTML，并构建了DOM树，但像图片、样式表之类的外部资源可能尚未加载完成
>
> load：浏览器不仅加载完成了HTML，还加载完所有的外部资源：图片、字体、样式等

使图片变小
- 压缩图片
- 更换图片格式，如Google提出的WebP
- 图片懒加载

一个页面如果一开始就加载整个站的图片，无疑会花很多时间，那么我们可以用 Placeholder 来代替图片，或者用小图来代替等

视图内看到的图片可以第一时间显式，没看到的先不用显示

> 图片的加载权重比较高，会让页面卡顿

![网页内容加载权重](/static/vW7DyaxABizjuNr.jpg)

## 最简单的实现——以小换大

最开始是小图片或 placeholder 图，等图片加载完毕后换成大图

小图所花的时间少，马上就能显示出来，然后通过 JS 显示原来的图

## 监听图片高度

最开始展示页面范围内的图片，然后往下滑再逐步展示图片

在这里也要做节流

主要技术点：节流 + 当前元素 offsetTop

## Intersection Observer


## 以实养战

我们已经用 JS 来实现了图片懒加载，但是这还不够。因为现在的项目基本基于 React/Vue 框架实现，我们来用 React 来实现一下图片懒加载

### 图片API

申请 unsplash API 的使用，

### 自定义Hooks

自定义 Intersection Observer Hooks

### 参考佳作

medium 加载缩略图，[线上Demo](https://codepen.io/jojobo/pen/QWEzYvY)

- 直到图片进入可视范围才加载图片
- 然后，加载一张模糊的缩略图
- 然后，加载全尺寸图片，并替代调缩略图